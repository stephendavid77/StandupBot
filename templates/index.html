<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Standup Bot</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        .description-box {
            border: 1px solid #eee;
            padding: 15px;
            margin-top: 10px;
            background-color: #f9f9f9;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <h1>Standup Bot</h1>
        <p>Configure and run your sprint reports.</p>

        <form id="report-form" action="/run" method="post">
            <div class="form-group">
                <label for="report_type"><h4>Select Report Type</h4></label>
                <select class="form-control" id="report_type" name="report_type">
                    <option value="daily">Daily Standup Summary</option>
                    <option value="full">Complete Sprint Analysis</option>
                    <option value="previous">Previous Sprint Retrospective</option>
                </select>
                <div class="description-box" id="report-type-description">
                    Select a report type to see a description.
                </div>
            </div>

            <hr class="my-4">

            <h4>Select Projects</h4>
            <div id="project-list">
                {% for project in projects %}
                    <div class="form-group form-check">
                        <input type="checkbox" class="form-check-input" id="project-{{ project.project_key }}" name="selected_projects" value="{{ project.project_key }}" checked>
                        <label class="form-check-label" for="project-{{ project.project_key }}">{{ project.project_key }} (Board ID: {{ project.board_id }})</label>
                    </div>
                {% endfor %}
            </div>

            <div id="new-projects"></div>

            <button type="button" class="btn btn-secondary btn-sm" id="add-project-btn">+ Add Project</button>

            <hr class="my-4">

            <h4>Options</h4>
            <div class="form-group form-check">
                <input type="checkbox" class="form-check-input" id="include_epics" name="include_epics" {% if run_settings.include_epics %}checked{% endif %}>
                <label class="form-check-label" for="include_epics">Include Epic Information</label>
            </div>

            <hr class="my-4">

            <button id="run-report-btn" type="submit" class="btn btn-success btn-lg btn-block">Generate Report</button>
        </form>
    </div>

    {% include 'loader.html' %}

    <script>
        const reportDescriptions = {
            "daily": "A concise summary perfect for daily stand-ups, highlighting progress, blockers, and risks.",
            "full": "A comprehensive analysis of the current sprint, including hygiene details and workload distribution.",
            "previous": "A retrospective report on the last completed sprint, focusing on performance and outcomes."
        };

        const reportTypeSelect = document.getElementById('report_type');
        const reportTypeDescription = document.getElementById('report-type-description');
        const addProjectBtn = document.getElementById('add-project-btn');
        const newProjectsContainer = document.getElementById('new-projects');
        let projectCounter = 0;

        function updateDescription() {
            reportTypeDescription.textContent = reportDescriptions[reportTypeSelect.value];
        }

        reportTypeSelect.addEventListener('change', updateDescription);
        updateDescription();

        addProjectBtn.addEventListener('click', function() {
            projectCounter++;
            const newProjectHtml = `
                <div class="row mt-2">
                    <div class="col">
                        <input type="text" class="form-control" name="new_project_key_${projectCounter}" placeholder="Project Key (e.g., PROJ)" required>
                    </div>
                    <div class="col">
                        <input type="number" class="form-control" name="new_board_id_${projectCounter}" placeholder="Board ID (e.g., 123)" required>
                    </div>
                </div>
            `;
            newProjectsContainer.insertAdjacentHTML('beforeend', newProjectHtml);
        });
    </script>
</body>
</html>